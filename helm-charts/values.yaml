global:
  db:
    host: &dbhost sec-postgresql
    name: smart_enough_city
    port: 5432
    schemas:
      dataHandlerSchema: "external_data"
      backendSchema: "backend"
      keycloakSchema: &keycloakSchema "keycloak"

postgresql:
  enabled: true
  fullnameOverride: *dbhost
  primary:
    persistence:
      enabled: true
      size: 10Gi
  auth:
    username: app_owner
    database: smart_enough_city
    existingSecret: sec-db-root

db:
  # Passwords auto-generated if empty
  root:
    postgresPassword: ""
    appOwnerPassword: ""
  users:
    dataHandlerPassword: ""
    backendUserPassword: ""
    keycloakPassword: ""

keycloak:
  enabled: true
  # Using legacy images from bitnamilegacy repository
  # This is a temporary workaround due to licensing changes with bitnami
  # See https://github.com/bitnami/charts/issues/35164 for details
  image:
    registry: docker.io
    repository: bitnamilegacy/keycloak
  keycloakConfigCli:
    image:
      registry: docker.io
      repository: bitnamilegacy/keycloak-config-cli
  postgresql:
    enabled: false
  externalDatabase:
    host: *dbhost
    port: 5432
    database: smart_enough_city
    schema: *keycloakSchema
    user: keycloak
    existingSecret: sec-db-keycloak-user
    existingSecretPasswordKey: DB_KEYCLOAK_PASSWORD
  auth:
    adminUser: "admin"
    existingSecret: sec-keycloak-admin
    passwordSecretKey: KEYCLOAK_ADMIN_PASSWORD
    # TODO to be handled properly using secrets
    adminUserPassword: "admin" # Auto-generated if empty
  production: false
  extraStartupArgs: "--import-realm"
  realm:
    enabled: true
    configMapName: keycloak-realm-import
    name: &keycloakRealmName "user-management-realm"
    clientId: &keycloakClientId "user-service"
    userServiceClientSecret: "dev-keycloak-user-service-secret"  # TODO handle it properly
  extraVolumes: |
    - name: realm-import
      configMap:
        name: keycloak-realm-import
  extraVolumeMounts: |
    - name: realm-import
      mountPath: /opt/bitnami/keycloak/data/import
      readOnly: true

hermes:
  enabled: true
  keycloak:
    realm: *keycloakRealmName
    clientId: *keycloakClientId
    secret:
      name: sec-keycloak-realm
      key: USER_SERVICE_CLIENT_SECRET

data-handler:
  enabled: true
  secrets:
    dbUser:
      name: sec-db-data-handler-user
    gtfsApiKey:
      name: sec-gtfs-api-key

inference-engine:
  enabled: true

frontend:
  enabled: true

ingress:
  enabled: true
  className: "nginx"
  annotations: {}
  hosts:
    - hermesPaths:
        - path: /api
          pathType: Prefix
      frontendPaths:
        - path: /
          pathType: Prefix
  tls: []
